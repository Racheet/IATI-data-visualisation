<!doctype html public "âœ°">

<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" >
  
  <title>index</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" charset="utf-8">
  <link rel="stylesheet" href="/css/master.css" type="text/css" media="screen" charset="utf-8">
  <link rel="stylesheet" href="/css/jquery-ui-1.8.16.custom.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
<h1>Explore our projects</h1>

	<div id="map_controls"> 
		<h2>Toolbox</h2>
		<p>Select the types of work you'd like to learn more about</p>
		<form action="#">
			<ul class="init" id="sector-filter-list">
				<li id="filter-loader">This tool currently requires javascript</li>
			</ul>
		</form>
	</div>
  <div id="map_canvas">This tool currently requires javascript</div>
  <div id="map_timeline">
	  <h2>Move through time</h2>
	  <div id="time-slider"></div>
  </div>

<script src="/javascript/jquery.js"></script>
<script src="/javascript/jquery-ui-1.8.16.custom.min.js"></script>
<script src="/javascript/d3.js"></script>
<script src="/javascript/_.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/javascript/site.js"></script>
<script src="https://www.google.com/jsapi"></script>

<script>

request.defaults = {
  format: "json",
  corpus: "fullB"
};
	

document.getElementById('map_canvas').innerHTML = 'Please wait - loding map.';
document.getElementById('sector-filter-list').innerHTML = 'Please wait - loding map.';

$("#sector-filter-list.init li").live ("click", function (e) {
	$(this).attr("checked", true);
	$(this).siblings().find("input[type=checkbox]").attr("checked", false);
	$(this).parent().removeClass("init");
	e.preventDefault ();
});


// get the list of sector categories
request({
  groupby: "SectorCategory",
  result: "values",
  }, function(response){
    
    var categories = _.as_array(response.SectorCategory);
    $("#sector-filter-list").html(' ');
    _.each(categories, function(sc){

				// <li><label><input type="checkbox" id="show_equity" /> Right to equity</label></li>
		$('<li><label><input checked="checked" type="checkbox" name="SectorCategory" value="' + sc.code + '" /> ' + sc.name + '</label></li>')
      // $('<li>')
      //   .text(sc.name)
      //   .click(function(){
      //     // TODO: implement this action
      //     console.log("Sector Category:", sc)
      //   })
        .appendTo('#sector-filter-list');

    });
});

  
// make a request for countries, then load in the google map
var chartsLoaded = function(){
  
  
  // load in all country values
  request({
    groupby: "Country",
    result: "values",
    }, function(response){
      var countries = _(response.Country).as_array();

       var data = new google.visualization.DataTable();
       var options = {dataMode:'regions'};
       
       data.addColumn('string', '', 'Country');
       data.addColumn('number', 'Activities', 'a');
       data.addRows(countries.length);
       $.map(countries, function(country, i) {
         data.setValue(i, 0, country.name);
         data.setValue(i, 1, parseFloat(country.count));
       });

      var container = document.getElementById('map_canvas');
      var geomap = new google.visualization.GeoChart(container);
      geomap.draw(data, options);
  });
};

google.load('visualization', '1.0', {packages:['geochart'], callback:chartsLoaded});

</script>

</body>
</html>
