<!doctype html public "âœ°">

<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" >
  
  <title>index</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<h1>ROHK</h1>

	<input id="country-code" value="AF" />
	<a id="submit">Click!</a>

<div id="results">
</div>



<script src="http://bit.ly/jqsource"></script>
<script src="/socket.io/socket.io.js"></script>


<script>
	
	var socket = io.connect ('http://' + location.host);

	var callbacks = {};
	var cbCounter = 0;
	var request = function (params, callback) {
		// register callback
		var cbid = 'cb'+(cbCounter++);
		callbacks[cbid] = callback;
		
		//send request
		socket.emit ('api', {params:params, cb:cbid});
	}
	socket.on ('api', function (data) {
		console.log("DATA",data);
		callbacks[data.cb](data.response);
		delete callbacks[data.cb]
	})
	
	request({result:'geo', pagesize:50, country:'AF', Funder:'GB-CHC-202918'}, function(data){
		console.log("GEO REQUEST:", data);
	})
	/*
	socket.on ('requestx', function (data) {
		console.log(data);
	
		$("#results").html (data.toString());
		console.log(data);

		var activities = data.message['iati-activity'];
		console.log(activities);
		var str = "";
		for (var i = 0; i < activities.length; i++ ) {
			var title = activities[i]['title']['#text'] || activities[i]['title']
			str += "<p>" + title + "</p>";
		}
		$("#results").html(str);
	});
	$(function () {
		$("#submit").click (function (e) {
			$("#results").html('loading...');
			e.preventDefault ();
			//socket.emit ('country-detail', $("#country-code").attr("value"));
			var code = $("#country-code").attr("value");
			var params = {result:'geo', pagesize:50, country:code, Funder:'GB-CHC-202918'}
			socket.emit ('request', params);
			return false;
		})
	});*/
</script>

</body>
</html>
