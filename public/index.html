<!doctype html public "âœ°">

<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" >
  
  <title>index</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<h1>RHOK</h1>

	<input id="country-code" value="AF" />
	<a id="submit">Click!</a>

<div id="results">
</div>
<ul id="sectorcategories"></ul>



<script src="/javascript/jquery.js"></script>
<script src="/javascript/d3.js"></script>
<script src="/javascript/_.js"></script>
<script src="/javascript/site.js"></script>
<script src="/socket.io/socket.io.js"></script>


<script>
	
	var socket = io.connect ('http://' + location.host);

	var callbacks = {};
	var cbCounter = 0;

	var default_settings = {
		result: 'full',
		pagesize: 50,
		Founder: 'GB-CHC-202918'
	};

	var request = function (params, callback) {
		// register callback
		var cbid = 'cb'+(cbCounter++);
		callbacks[cbid] = callback;
		
		//send request
		socket.emit ('api', {params:params, cb:cbid});
	}
	socket.on ('api', function (data) {
		callbacks[data.cb](data.response);
		delete callbacks[data.cb]
	});
	
	
// get the list of sector categories
request({
  groupby: "SectorCategory",
  result: "values",
  format: "json",
  corpus: "fullB"
  }, function(response){
    var categories = _.as_array(response.SectorCategory);
    
    _.each(categories, function(sc){
      $('<li>')
        .text(sc.name)
        .click(function(){
          // TODO: implement this action
          console.log("Sector Category:", sc)
        })
        .appendTo('#sectorcategories');
    });
});


</script>

</body>
</html>
